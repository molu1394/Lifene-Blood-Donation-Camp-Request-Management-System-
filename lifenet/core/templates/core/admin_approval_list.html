{% extends base_template %}
{%load static%}

{% block extra_css %}
<link rel="stylesheet" href="{%static 'css/approvallist.css' %}">
<link rel="stylesheet" href="{%static 'css/message.css'%}">
{% endblock %}

{% block content %}
<div class="messagesbox">
    {% if messages %}
        <div class="messages">
            {% for message in messages|dictsortreversed:"level" %}
                <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
                    <h1>{{ message }}</h1>
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>
{% if user.is_authenticated and user.role == 'ADMIN' %}
  <h1>Approval Requests</h1>

  <h3>Blood Banks</h3>
  {% if bloodbanks %}
  <table class="bb-table">
    <thead>
      <th>Name</th>
      <th>Status</th>
      <th>Authorize Number</th>
      <th>Actions</th>
    </thead>

    <tbody>
      {% for bb in bloodbanks %}
      <tr>
        <td>{{ bb.bloodbank_name }}</td>
        <td>{{ bb.approval_status }}</td>
        <td>{{ bb.authorize_number }}</td>
        <td>
          {% if bb.approval_status == "Pending" %}
          <form method="post" action="{% url 'core:admin-approval-action' 'bloodbank' bb.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" name="action" value="approve">Approve</button>
            <button type="submit" name="action" value="deny">Deny</button>
          </form>
          {% else %}<em>No action</em>{% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>

  </table>
  {% else %}<p>No bloodbanks found.</p>{% endif %}


  <h3>Organizations</h3>
  {% if organizations %}
  <table class="org-table">
    <thead>
      <th>Name</th>
      <th>Status</th>
      <th>Authorize Number</th>
      <th>Actions</th>
    </thead>

    <tbody>
      {% for org in organizations %}
      <tr>
        <td>{{ org.organization_name }}</td>
        <td>{{ org.approval_status }}</td>
        <td>{{ org.authorize_number }}</td>
        <td>
          {% if org.approval_status == "Pending" %}
          <form method="post" action="{% url 'core:admin-approval-action' 'organization' org.id %}"
            style="display:inline;">
            {% csrf_token %}
            <button type="submit" name="action" value="approve">Approve</button>
            <button type="submit" name="action" value="deny">Deny</button>
          </form>
          {% else %}<em>No action</em>{% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>

  </table>
  {% else %}<p>No organizations found.</p>{% endif %}
{% else %}
<div class="container mt-5 text-center">
    <h1 class="text-danger">⚠️ Login as ADMIN</h1>
</div>
{% endif %}
{% endblock %}